<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Mavi Petshop</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
  <style>
    body {
      background-color: #f0f0f2;
      margin: 0;
      padding: 0;
      font-family: -apple-system, system-ui, BlinkMacSystemFont, 'Segoe UI', 'Open Sans', 'Helvetica Neue', Helvetica, Arial, sans-serif;
    }
    body.dark-mode {
      background-color: #181a20;
    }
    .main-box {
      width: 100%;
      max-width: 900px;
      margin: 4em auto 2em auto;
      padding: 2.5em 2em 2em 2em;
      background-color: #fdfdff;
      border-radius: 0.7em;
      box-shadow: 2px 3px 14px 2px rgba(0,0,0,0.06);
    }
    .main-box.dark-mode {
      background-color: #23262f;
      color: #f3f6fa;
      box-shadow: 2px 3px 14px 2px rgba(0,0,0,0.18);
    }
    .site-title {
      font-size: 2.5rem;
      font-weight: 900;
      color: #053ff3;
      margin-bottom: 0.5em;
      text-align: center;
      letter-spacing: 1px;
    }
    .site-title.dark-mode { color: #6ea8fe; }
    .site-desc {
      color: #444;
      font-size: 1.1rem;
      text-align: center;
      margin-bottom: 2em;
    }
    .site-desc.dark-mode { color: #bfc9d8; }
    .filter-card {
      background: #fff;
      border-radius: 0.7em;
      box-shadow: 0 4px 16px rgba(5,63,243,0.06);
      padding: 1.5em 1em 1em 1em;
      margin-bottom: 2em;
    }
    .filter-card.dark { background: #23262f; box-shadow: 0 4px 16px rgba(5,63,243,0.18); }
    .product-list {
      margin-top: 2em;
    }
    .product-item {
      margin-bottom: 2em;
    }
    .product-card {
      border: none;
      border-radius: 1em;
      box-shadow: 0 4px 16px rgba(5,63,243,0.08);
      background: #fff;
      padding-bottom: 1em;
      transition: box-shadow .2s, transform .2s;
    }
    .product-card.dark { background: #23262f; color: #f3f6fa; box-shadow: 0 4px 16px rgba(5,63,243,0.18); }
    .product-card:hover {
      box-shadow: 0 8px 32px rgba(5,63,243,0.13);
      transform: translateY(-4px) scale(1.01);
    }
    .product-card img {
      object-fit: cover;
      height: 220px;
      border-top-left-radius: 1em;
      border-top-right-radius: 1em;
      width: 100%;
    }
    .card-title {
      font-size: 1.1rem;
      font-weight: 700;
      color: #222;
    }
    .card-title.dark, body.dark .card-title { color: #f3f6fa; }
    .text-muted {
      color: #888 !important;
      font-size: 0.95rem;
    }
    .text-muted.dark, body.dark .text-muted { color: #bfc9d8 !important; }
    .text-success {
      color: #009688 !important;
      font-weight: 700;
    }
    .btn-outline-primary {
      border-radius: .75rem;
      font-weight: 600;
      color: #053ff3;
      border-color: #053ff3;
      transition: background .2s, color .2s;
    }
    .btn-outline-primary.dark { color: #6ea8fe; border-color: #6ea8fe; }
    .btn-outline-primary:hover {
      background: #053ff3;
      color: #fff;
    }
    .btn-outline-primary.dark:hover { background: #6ea8fe; color: #fff; }
    .cart-btn {
      margin-left: 1em;
      border-radius: 1.5em;
      padding: 0.4em 1.1em;
      font-size: 1rem;
      box-shadow: 0 2px 8px rgba(5,63,243,0.08);
      background: #fff;
      transition: background .2s, color .2s;
    }
    .cart-btn.dark { background: #181a20; color: #6ea8fe; border-color: #6ea8fe; }
    .cart-btn:hover {
      background: #053ff3;
      color: #fff;
      border-color: #053ff3;
    }
    .cart-btn.dark:hover { background: #6ea8fe; color: #fff; }
    @media (max-width: 700px) {
      .main-box { margin: 0.5em auto; padding: 1em 0.5em; }
      .site-title { font-size: 1.5rem; flex-direction: column; gap: 0.7em; align-items: stretch !important; }
      .product-card img { height: 140px; }
      .cart-btn, .site-title .btn-primary, #themeToggle { width: 100%; justify-content: center; margin-left: 0; margin-top: 0.5em; }
      .site-title .d-flex.align-items-center.gap-2 { flex-direction: column; gap: 0.5em; width: 100%; }
      .carousel-caption h5 { font-size: 0.95rem; padding: .4em .7em; }
    }
  </style>
</head>
<body>
  <div class="main-box position-relative">
    <div class="site-title d-flex justify-content-between align-items-center">
      <span>Mavi Petshop</span>
      <div class="d-flex align-items-center gap-2">
        <a href="/cart" class="cart-btn btn d-flex align-items-center" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); color: white; border: none; padding: 12px 24px; border-radius: 30px; font-weight: 600; font-size: 14px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 15px rgba(16, 185, 129, 0.3); text-decoration: none; gap: 0.5em;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(16, 185, 129, 0.4)'; this.style.background='linear-gradient(135deg, #059669 0%, #047857 100%)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(16, 185, 129, 0.3)'; this.style.background='linear-gradient(135deg, #10b981 0%, #059669 100%)'">
          <i class="fa fa-shopping-cart"></i>
          <span>Sepet{% if session.cart %} ({{ session.cart|length }}){% endif %}</span>
        </a>
        <a href="/contact" class="btn d-flex align-items-center" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%); color: white; border: none; padding: 12px 24px; border-radius: 30px; font-weight: 600; font-size: 14px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 15px rgba(245, 158, 11, 0.3); text-decoration: none;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(245, 158, 11, 0.4)'; this.style.background='linear-gradient(135deg, #d97706 0%, #b45309 100%)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(245, 158, 11, 0.3)'; this.style.background='linear-gradient(135deg, #f59e0b 0%, #d97706 100%)'">Bize Ulaşın</a>
        <a href="/order-track" class="btn d-flex align-items-center" style="background: linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%); color: white; border: none; padding: 12px 24px; border-radius: 30px; font-weight: 600; font-size: 14px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3); text-decoration: none;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(99, 102, 241, 0.4)'; this.style.background='linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(99, 102, 241, 0.3)'; this.style.background='linear-gradient(135deg, #6366f1 0%, #8b5cf6 100%)'"><i class="fa fa-truck me-2"></i>Sipariş Takip</a>
        <button id="themeToggle" class="btn d-flex align-items-center" style="background: linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%); color: #374151; border: none; padding: 12px; border-radius: 50%; font-weight: 600; font-size: 16px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); width: 42px; height: 42px; justify-content: center;" title="Tema Değiştir" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(0, 0, 0, 0.15)'; this.style.background='linear-gradient(135deg, #e5e7eb 0%, #d1d5db 100%)'; this.style.color='#1f2937'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(0, 0, 0, 0.1)'; this.style.background='linear-gradient(135deg, #f3f4f6 0%, #e5e7eb 100%)'; this.style.color='#374151'">
          <i id="themeIcon" class="fa fa-moon"></i>
        </button>
      </div>
      </div>
    <div class="site-desc">
      Türkiye'nin en güvenilir online petshop'u. Kedi, köpek, kuş ve balık ürünlerinde uygun fiyat ve hızlı teslimat!<br>
      <span style="color:#053ff3;font-weight:600;">Hoş geldiniz!</span>
    </div>

    {% if campaigns and campaigns|length > 0 %}
    <div class="mb-4">
      <div id="campaignCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="3500" data-bs-wrap="true">
        <div class="carousel-inner" style="border-radius: 1em; box-shadow: 0 4px 16px rgba(5,63,243,0.10); overflow: hidden;">
          {% for c in campaigns %}
          <div class="carousel-item {% if loop.index0 == 0 %}active{% endif %}">
            <a href="{{ c.link }}" target="_blank">
              <img src="{{ c.image }}" class="d-block w-100" alt="Kampanya" style="object-fit:cover; width:100%; max-height:270px; background:#e3f0ff;">
              {% if c.title %}
              <div class="carousel-caption d-block" style="bottom:1.5rem;">
                <h5 style="background:rgba(5,63,243,0.85);color:#fff;padding:.5em 1em;border-radius:.7em;display:inline-block;font-size:1.1rem;">{{ c.title }}</h5>
      </div>
              {% endif %}
        </a>
      </div>
          {% endfor %}
      </div>
        <button class="carousel-control-prev" type="button" data-bs-target="#campaignCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Önceki</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#campaignCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Sonraki</span>
        </button>
      </div>
    </div>
    {% endif %}

    {% if selected_category %}
    <div class="alert alert-info d-flex justify-content-between align-items-center" style="background: linear-gradient(135deg, #e0f2fe 0%, #b3e5fc 100%); border: 1px solid rgba(59, 130, 246, 0.2); border-radius: 15px; padding: 15px 20px; color: #1565c0; font-weight: 500;">
      <div><b>Kategori:</b> {{ selected_category }}</div>
      <a href="/change_category" class="btn btn-sm" style="background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); color: white; border: none; padding: 8px 16px; border-radius: 25px; font-weight: 600; font-size: 12px; text-transform: uppercase; letter-spacing: 0.5px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3); position: relative; overflow: hidden; text-decoration: none;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(59, 130, 246, 0.4)'; this.style.background='linear-gradient(135deg, #2563eb 0%, #7c3aed 100%)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(59, 130, 246, 0.3)'; this.style.background='linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%)'">Kategoriyi Değiştir</a>
  </div>
    {% endif %}

  <!-- Kategori Mega Menü -->
<div class="category-mega-menu mb-4" style="position: relative;">
  <div class="category-buttons d-flex flex-wrap gap-2" style="margin-bottom: 1rem;" id="categoryButtons">
         <button class="category-btn" data-category="Mama" onclick="handleCategoryClick(this)" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 24px; margin: 0 8px 8px 0; border-radius: 50px; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); position: relative; overflow: hidden; text-decoration: none; display: inline-block;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(102, 126, 234, 0.4)'; this.style.background='linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.3)'; this.style.background='linear-gradient(135deg, #667eea 0%, #764ba2 100%)'">
       <span class="category-text">Mama</span>
     </button>
     <button class="category-btn" data-category="Ödül & Eğitim" onclick="handleCategoryClick(this)" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 24px; margin: 0 8px 8px 0; border-radius: 50px; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); position: relative; overflow: hidden; text-decoration: none; display: inline-block;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(102, 126, 234, 0.4)'; this.style.background='linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.3)'; this.style.background='linear-gradient(135deg, #667eea 0%, #764ba2 100%)'">
       <span class="category-text">Ödül & Eğitim</span>
     </button>
     <button class="category-btn" data-category="Bakım & Sağlık" onclick="handleCategoryClick(this)" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 24px; margin: 0 8px 8px 0; border-radius: 50px; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); position: relative; overflow: hidden; text-decoration: none; display: inline-block;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(102, 126, 234, 0.4)'; this.style.background='linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.3)'; this.style.background='linear-gradient(135deg, #667eea 0%, #764ba2 100%)'">
       <span class="category-text">Bakım & Sağlık</span>
     </button>
     <button class="category-btn" data-category="Aksesuar" onclick="handleCategoryClick(this)" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 24px; margin: 0 8px 8px 0; border-radius: 50px; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); position: relative; overflow: hidden; text-decoration: none; display: inline-block;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(102, 126, 234, 0.4)'; this.style.background='linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.3)'; this.style.background='linear-gradient(135deg, #667eea 0%, #764ba2 100%)'">
       <span class="category-text">Aksesuar</span>
     </button>
     <button class="category-btn" data-category="Marka" onclick="handleCategoryClick(this)" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 24px; margin: 0 8px 8px 0; border-radius: 50px; font-weight: 600; font-size: 14px; cursor: pointer; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3); position: relative; overflow: hidden; text-decoration: none; display: inline-block;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(102, 126, 234, 0.4)'; this.style.background='linear-gradient(135deg, #5a67d8 0%, #6b46c1 100%)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.3)'; this.style.background='linear-gradient(135deg, #667eea 0%, #764ba2 100%)'">
       <span class="category-text">Marka</span>
     </button>
  </div>
  
  <div class="subcategory-dropdown" style="display:none; position:absolute; top:60px; left:0; min-width:220px; background:linear-gradient(135deg, #ffffff 0%, #f8fafc 100%); border: 1px solid rgba(99, 102, 241, 0.1); border-radius:15px; box-shadow:0 20px 40px rgba(0, 0, 0, 0.1); padding:15px; backdrop-filter: blur(10px); z-index:100; list-style:none;"></div>
</div>
<style>
.category-bar .dropdown:hover > .subcategory-dropdown { display: block !important; }
.category-bar .dropdown:focus-within > .subcategory-dropdown { display: block !important; }
.category-btn { cursor:pointer; }
</style>
<script>
// DARK MODE TOGGLE
(function() {
  const themeToggle = document.getElementById('themeToggle');
  const themeIcon = document.getElementById('themeIcon');
  function setTheme(dark) {
    if(dark) {
      document.body.classList.add('dark-mode');
      document.querySelector('.main-box').classList.add('dark-mode');
      themeIcon.classList.remove('fa-moon');
      themeIcon.classList.add('fa-sun');
    } else {
      document.body.classList.remove('dark-mode');
      document.querySelector('.main-box').classList.remove('dark-mode');
      themeIcon.classList.remove('fa-sun');
      themeIcon.classList.add('fa-moon');
    }
    localStorage.setItem('theme', dark ? 'dark' : 'light');
  }
  if(themeToggle) {
    themeToggle.addEventListener('click', function(e) {
      e.preventDefault();
      setTheme(!document.body.classList.contains('dark-mode'));
    });
    // İlk yüklemede tema kontrolü
    if(localStorage.getItem('theme') === 'dark') setTheme(true);
  }
})();
</script>
<script>
window.selectedCategory = "{{ selected_category|default('Köpek') }}";

// Kategori butonuna tıklandığında çalışacak fonksiyon - GLOBAL olarak tanımlı
window.handleCategoryClick = function(button) {
  console.log('Kategori butonuna tıklandı:', button.dataset.category);
  
  // Tüm butonları normal yap
  document.querySelectorAll('.category-btn').forEach(btn => {
    btn.style.opacity = '0.7';
  });
  
  // Tıklanan butonu aktif yap
  button.style.opacity = '1';
  
  // Filtreleme uygula
  if (typeof filterByMainCategory === 'function') {
    filterByMainCategory(button.dataset.category);
  }
  
  // Alt kategori dropdown'ını göster
  if (typeof showSubcategories === 'function') {
    showSubcategories(button.dataset.category, button);
  }
};

const megaMenuData = {
  'Köpek': {
    'Mama': [
      'Yavru Köpek Maması', 'Yetişkin Köpek Maması', 'Kısırlaştırılmış Köpek Maması', 'Konserve Köpek Maması'
    ],
    'Ödül & Eğitim': [
      'Köpek Ödülleri', 'Köpek Eğitim Ürünleri'
    ],
    'Bakım & Sağlık': [
      'Köpek Bakım Ürünleri', 'Köpek Sağlık Ürünleri'
    ],
    'Aksesuar': [
      'Köpek Tasmaları', 'Köpek Mama ve Su Kapları', 'Köpek Kafesleri', 'Köpek Taşıma Çantaları', 'Köpek Yatakları', 'Köpek Oyuncakları'
    ],
    'Marka': [
      'Acana', 'Advance', 'Brit Care', 'Pro Plan', 'Royal Canin', "Hill's", 'Orijen'
    ]
  },
  'Kedi': {
    'Mama': [
      'Yavru Kedi Maması', 'Yetişkin Kedi Maması', 'Kısırlaştırılmış Kedi Maması', 'Konserve Kedi Maması'
    ],
    'Ödül & Eğitim': [
      'Kedi Ödülleri', 'Kedi Eğitim Ürünleri'
    ],
    'Bakım & Sağlık': [
      'Kedi Bakım Ürünleri', 'Kedi Sağlık Ürünleri'
    ],
    'Aksesuar': [
      'Kedi Kumları', 'Kedi Tuvaleti ve Ürünleri', 'Kedi Aksesuarları', 'Kedi Oyuncakları', 'Kedi Tasmaları', 'Kedi Mama ve Su Kapları', 'Kedi Kafesleri', 'Kedi Taşıma Çantaları', 'Kedi Tırmalamaları', 'Kedi Yatakları'
    ],
    'Marka': [
      'Acana', 'Advance', 'Brit Care', 'Pro Plan', 'Royal Canin', "Hill's", 'Orijen'
    ]
  },
  'Kuş': {
    'Yem': [ 'Kuş Yemleri' ],
    'Bakım & Sağlık': [ 'Kuş Vitaminleri', 'Kuş Sağlık Ürünleri' ],
    'Aksesuar': [ 'Kuş Kafesleri', 'Kuş Oyuncakları', 'Kuş Aksesuarları', 'Kuş Banyosu' ],
    'Marka': [ 'Acana', 'Advance', 'Brit Care', 'Pro Plan', 'Royal Canin', "Hill's", 'Orijen' ]
  },
  'Balık': {
    'Yem': [ 'Balık Yemleri' ],
    'Bakım & Sağlık': [ 'Balık Sağlık Ürünleri' ],
    'Aksesuar': [ 'Akvaryumlar', 'Akvaryum Ekipmanları', 'Balık Dekorasyon' ],
    'Marka': [ 'Acana', 'Advance', 'Brit Care', 'Pro Plan', 'Royal Canin', "Hill's", 'Orijen' ]
  }
};
// Alt kategori gösterme işlevi
function showSubcategories(categoryName, button) {
  const subcatDropdown = document.querySelector('.subcategory-dropdown');
  const selectedCategory = window.selectedCategory || 'Köpek';
  
  if (!megaMenuData[selectedCategory] || !megaMenuData[selectedCategory][categoryName]) {
    return;
  }
  
  const subcats = megaMenuData[selectedCategory][categoryName];
  let html = `<div class='subcat-group'>`;
  html += `<div class='subcat-group-title' style='font-weight: 700; color: #374151; margin-bottom: 10px; font-size: 16px;'>${categoryName}</div>`;
  
  subcats.forEach(sub => {
    html += `<a href="#" class="subcat-link" data-subcat="${sub}" style="color: #4b5563; text-decoration: none; display: block; padding: 8px 15px; border-radius: 10px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); font-weight: 500; font-size: 14px; margin-bottom: 4px;" onmouseover="this.style.background='linear-gradient(135deg, #667eea 0%, #764ba2 100%)'; this.style.color='white'; this.style.transform='translateX(5px)'; this.style.boxShadow='0 4px 15px rgba(102, 126, 234, 0.3)';" onmouseout="this.style.background='transparent'; this.style.color='#4b5563'; this.style.transform='translateX(0)'; this.style.boxShadow='none';" onclick="navigateToSubcategory('${sub}')">${sub}</a>`;
  });
  html += `</div>`;
  
  subcatDropdown.innerHTML = html;
  subcatDropdown.style.display = 'block';
  
  // Pozisyon ayarla
  const rect = button.getBoundingClientRect();
  const containerRect = document.querySelector('.category-mega-menu').getBoundingClientRect();
  subcatDropdown.style.left = (rect.left - containerRect.left) + 'px';
}

// Alt kategori gizleme işlevi
function hideSubcategories() {
  const subcatDropdown = document.querySelector('.subcategory-dropdown');
  if (subcatDropdown) {
    subcatDropdown.style.display = 'none';
  }
}

// Alt kategoriye tıklandığında navigasyon
function navigateToSubcategory(subcat) {
  console.log('Alt kategoriye tıklandı:', subcat);
  const selectedCategory = window.selectedCategory || 'Köpek';
  
  if (megaMenuData[selectedCategory]['Marka'].includes(subcat)) {
    console.log('Marka filtresi uygulanıyor:', subcat);
    filterProducts('', '', subcat);
  } else {
    console.log('Alt kategori filtresi uygulanıyor:', subcat);
    filterProducts('', subcat, '');
  }
  
  // Alt menüyü kapat
  hideSubcategories();
}

// Ana kategori filtresi
function filterByMainCategory(mainCategory) {
  console.log('Ana kategori filtresi çalıştırılıyor:', mainCategory);
  if (typeof filterProducts === 'function') {
    filterProducts(mainCategory, '', '');
  } else {
    console.log('filterProducts fonksiyonu bulunamadı');
  }
}

// Çift tanım kaldırıldı - window.handleCategoryClick kullanılıyor

// AJAX ile dinamik ürün filtreleme
function filterProducts(mainCategory = '', subcategory = '', brand = '') {
  const params = new URLSearchParams();
  
  if (mainCategory) params.set('main_category', mainCategory);
  if (subcategory) params.set('subcategory', subcategory);
  if (brand) params.set('brand', brand);
  
  // Loading göster
  const productList = document.getElementById('productList');
  productList.innerHTML = '<div class="col-12 text-center"><div class="spinner-border text-primary" role="status"><span class="visually-hidden">Yükleniyor...</span></div></div>';
  
  fetch(`/api/filter_products?${params.toString()}`)
    .then(response => response.json())
    .then(data => {
      if (data.products) {
        displayProducts(data.products);
      } else {
        productList.innerHTML = '<div class="col-12 text-center"><p class="text-muted">Ürün bulunamadı</p></div>';
      }
    })
    .catch(error => {
      console.error('Filtreleme hatası:', error);
      productList.innerHTML = '<div class="col-12 text-center"><p class="text-danger">Bir hata oluştu</p></div>';
    });
}

// Ürünleri göster
function displayProducts(products) {
  const productList = document.getElementById('productList');
  let html = '';
  
  products.forEach(product => {
    const subcategoryText = Array.isArray(product.subcategory) ? product.subcategory.join(', ') : product.subcategory;
    const brandBadge = product.brand ? `<span class="badge bg-secondary ms-2">${product.brand}</span>` : '';
    
    html += `
      <div class="col-md-4 product-item">
        <div class="card product-card h-100">
          <a href="/product/${product.id}">
            <img src="${product.image}" class="card-img-top" alt="${product.name}"/>
          </a>
          <div class="card-body d-flex flex-column">
            <h5 class="card-title">${product.name}${brandBadge}</h5>
            <p class="text-muted">${product.category} / ${subcategoryText}</p>
            <h6 class="text-success">${product.price} TL</h6>
            <a href="/add_to_cart/${product.id}" class="btn mt-auto" style="background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); color: white; border: none; padding: 10px 20px; border-radius: 25px; font-weight: 600; font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3); text-decoration: none;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(59, 130, 246, 0.4)'; this.style.background='linear-gradient(135deg, #2563eb 0%, #7c3aed 100%)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(59, 130, 246, 0.3)'; this.style.background='linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%)'">Sepete Ekle</a>
          </div>
        </div>
      </div>
    `;
  });
  
  productList.innerHTML = html;
}

// Kategori butonlarını hayvan türüne göre güncelle
function updateCategoryButtons() {
  const selectedCategory = window.selectedCategory || 'Köpek';
  const categoryButtons = document.querySelectorAll('.category-btn');
  
  if (!megaMenuData[selectedCategory]) {
    console.log('MegaMenuData bulunamadı:', selectedCategory);
    return;
  }
  
  const categories = Object.keys(megaMenuData[selectedCategory]);
  console.log('Kategoriler:', categories);
  
  categoryButtons.forEach((button, index) => {
    if (categories[index]) {
      const categoryName = categories[index];
      button.setAttribute('data-category', categoryName);
      const textSpan = button.querySelector('.category-text');
      if (textSpan) {
        textSpan.textContent = categoryName;
      }
    }
  });
}

// Kategori butonlarına event listener'ları ekle
function addCategoryButtonEvents() {
  const categoryButtons = document.querySelectorAll('.category-btn');
  console.log('Kategori butonları bulundu:', categoryButtons.length);
  
  categoryButtons.forEach(button => {
    const category = button.dataset.category;
    console.log('Buton için event listener ekleniyor:', category);
    
    // Sadece onclick kullanacağız, hover kaldırıldı
    button.addEventListener('mouseenter', function() {
      if (typeof showSubcategories === 'function') {
        showSubcategories(category, button);
      }
    });
    
    button.addEventListener('mouseleave', function() {
      // 2 saniye bekle
      window.hideMenuTimeout = setTimeout(function() {
        if (typeof hideSubcategories === 'function') {
          hideSubcategories();
        }
      }, 2000);
    });
  });
}

// Sayfa yüklendiğinde kategori butonlarını güncelle
document.addEventListener('DOMContentLoaded', function() {
  console.log('DOM yüklendi');
  updateCategoryButtons();
  addCategoryButtonEvents();
  
  // Alt menü hover
  const subcatDropdown = document.querySelector('.subcategory-dropdown');
  if (subcatDropdown) {
    subcatDropdown.addEventListener('mouseenter', function() {
      // Menü açık kalır - timeout'u iptal et
      clearTimeout(window.hideMenuTimeout);
    });
    
    subcatDropdown.addEventListener('mouseleave', function() {
      // 2 saniye bekle
      window.hideMenuTimeout = setTimeout(hideSubcategories, 2000);
    });
  }
});
</script>

  <!-- Ürünler -->
    <div class="container-fluid product-list">
    <div class="row" id="productList">
      {% for product in products %}
        <div class="col-md-4 product-item">
        <div class="card product-card h-100">
          <a href="/product/{{ product.id }}">
            <img src="{{ product.image }}" class="card-img-top" alt="{{ product.name }}"/>
          </a>
          <div class="card-body d-flex flex-column">
              <h5 class="card-title{% if dark %} dark{% endif %}">{{ product.name }}
                {% if product.brand %}<span class="badge bg-secondary ms-2">{{ product.brand }}</span>{% endif %}
              </h5>
              <p class="text-muted{% if dark %} dark{% endif %}">{{ product.category }} /
                {% if product.subcategory is string %}
                  {{ product.subcategory }}
                {% else %}
                  {{ product.subcategory|join(', ') }}
                {% endif %}
              </p>
            <h6 class="text-success">{{ product.price }} TL</h6>
            <a href="/add_to_cart/{{ product.id }}" class="btn mt-auto" style="background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%); color: white; border: none; padding: 10px 20px; border-radius: 25px; font-weight: 600; font-size: 13px; text-transform: uppercase; letter-spacing: 0.5px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); box-shadow: 0 4px 15px rgba(59, 130, 246, 0.3); text-decoration: none;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 25px rgba(59, 130, 246, 0.4)'; this.style.background='linear-gradient(135deg, #2563eb 0%, #7c3aed 100%)'" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 15px rgba(59, 130, 246, 0.3)'; this.style.background='linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%)'">Sepete Ekle</a>
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  </div>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Tema toggle scripti
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = document.getElementById('themeIcon');
    function setDarkMode(on) {
      document.body.classList.toggle('dark-mode', on);
      document.querySelector('.main-box').classList.toggle('dark-mode', on);
      document.querySelector('.site-title').classList.toggle('dark-mode', on);
      document.querySelector('.site-desc').classList.toggle('dark-mode', on);
      document.querySelector('.filter-card').classList.toggle('dark-mode', on);
      document.querySelectorAll('.product-card').forEach(e=>e.classList.toggle('dark-mode', on));
      document.querySelectorAll('.btn-outline-primary').forEach(e=>e.classList.toggle('dark-mode', on));
      document.querySelectorAll('.btn-primary').forEach(e=>e.classList.toggle('dark-mode', on));
      document.querySelectorAll('.alert-info').forEach(e=>e.classList.toggle('dark-mode', on));
      document.querySelectorAll('.form-control').forEach(e=>e.classList.toggle('dark-mode', on));
      document.querySelectorAll('.form-select').forEach(e=>e.classList.toggle('dark-mode', on));
      document.querySelectorAll('.form-label').forEach(e=>e.classList.toggle('dark-mode', on));
      document.querySelectorAll('.cart-btn').forEach(e=>e.classList.toggle('dark-mode', on));
      document.querySelectorAll('.btn-light').forEach(e=>e.classList.toggle('dark-mode', on));
      themeIcon.className = on ? 'fa fa-sun' : 'fa fa-moon';
    }
    // Local storage ile tema kalıcı olsun
    if(localStorage.getItem('darkMode')==='true') setDarkMode(true);
    themeToggle.addEventListener('click',()=>{
      const isDark = document.body.classList.toggle('dark-mode');
      setDarkMode(isDark);
      localStorage.setItem('darkMode', isDark);
    });
    // Kategoriye göre alt başlıklar
    const subcategories = {
        'Kedi': {
            'Mama': [
                'Yavru Kedi Maması', 'Yetişkin Kedi Maması', 'Kısırlaştırılmış Kedi Maması', 'Konserve Kedi Maması'
            ],
            'Ödül & Eğitim': [
                'Kedi Ödülleri', 'Kedi Eğitim Ürünleri'
            ],
            'Bakım & Sağlık': [
                'Kedi Bakım Ürünleri', 'Kedi Sağlık Ürünleri'
            ],
            'Aksesuar': [
                'Kedi Kumları', 'Kedi Tuvaleti ve Ürünleri', 'Kedi Aksesuarları', 'Kedi Oyuncakları', 'Kedi Tasmaları', 'Kedi Mama ve Su Kapları', 'Kedi Kafesleri', 'Kedi Taşıma Çantaları', 'Kedi Tırmalamaları', 'Kedi Yatakları'
            ],
            'Marka': [
                'Popüler Markalar'
            ]
        },
        'Köpek': {
            'Mama': [
                'Yavru Köpek Maması', 'Yetişkin Köpek Maması', 'Kısırlaştırılmış Köpek Maması', 'Konserve Köpek Maması'
            ],
            'Ödül & Eğitim': [
                'Köpek Ödülleri', 'Köpek Eğitim Ürünleri'
            ],
            'Bakım & Sağlık': [
                'Köpek Bakım Ürünleri', 'Köpek Sağlık Ürünleri'
            ],
            'Aksesuar': [
                'Köpek Tasmaları', 'Köpek Mama ve Su Kapları', 'Köpek Kafesleri', 'Köpek Taşıma Çantaları', 'Köpek Yatakları', 'Köpek Oyuncakları'
            ],
            'Marka': [
                'Popüler Markalar'
            ]
        },
        'Kuş': {
            'Mama': [
                'Kuş Yemleri'
            ],
            'Bakım & Sağlık': [
                'Kuş Vitaminleri', 'Kuş Sağlık Ürünleri'
            ],
            'Aksesuar': [
                'Kuş Kafesleri', 'Kuş Oyuncakları', 'Kuş Aksesuarları', 'Kuş Banyosu'
            ],
            'Marka': [
                'Popüler Markalar'
            ]
        },
        'Balık': {
            'Mama': [
                'Balık Yemleri'
            ],
            'Bakım & Sağlık': [
                'Balık Sağlık Ürünleri'
            ],
            'Aksesuar': [
                'Akvaryumlar', 'Akvaryum Ekipmanları', 'Balık Dekorasyon'
            ],
            'Marka': [
                'Popüler Markalar'
            ]
        }
    };
    const categorySelect = document.querySelector('select[name="category"]');
    const subcategorySelect = document.getElementById('subcategoryFilter');
    function updateSubcategories() {
        const cat = categorySelect ? categorySelect.value : (window.selectedCategory || '');
        subcategorySelect.innerHTML = '';
        const allOpt = document.createElement('option');
        allOpt.value = '';
        allOpt.textContent = 'Hepsi';
        subcategorySelect.appendChild(allOpt);
        if(subcategories[cat]) {
            Object.entries(subcategories[cat]).forEach(([group, subs]) => {
                const optgroup = document.createElement('optgroup');
                optgroup.label = group;
                subs.forEach(sub => {
                    const opt = document.createElement('option');
                    opt.value = sub;
                    opt.textContent = sub;
                    optgroup.appendChild(opt);
                });
                subcategorySelect.appendChild(optgroup);
            });
        }
    }
    if(categorySelect) categorySelect.addEventListener('change', updateSubcategories);
    window.addEventListener('DOMContentLoaded', updateSubcategories);
  </script>
</body>
</html>