<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="description" content="Türkiye'nin en güvenilir online petshop'u. Kedi, köpek, kuş ve balık ürünlerinde uygun fiyat ve hızlı teslimat!"/>
  <meta name="keywords" content="petshop, kedi maması, köpek maması, pet ürünleri, online petshop"/>
  <title>Pethome - Online Pet Ürünleri</title>
  
  <!-- Preload critical resources -->
  <link rel="preload" href="{{ url_for('static', filename='modern.css') }}?v=1.3.0" as="style">
  <link rel="preload" href="{{ url_for('static', filename='app.js') }}" as="script">
  
  <!-- Critical CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
  <link href="{{ url_for('static', filename='modern.css') }}?v=1.3.0" rel="stylesheet"/>
  
  <!-- PWA Meta Tags -->
  <meta name="theme-color" content="#667eea"/>
  <meta name="apple-mobile-web-app-capable" content="yes"/>
  <meta name="apple-mobile-web-app-status-bar-style" content="default"/>
  <meta name="apple-mobile-web-app-title" content="Pethome"/>
  <meta name="msapplication-TileColor" content="#667eea"/>
  <meta name="msapplication-TileImage" content="{{ url_for('static', filename='icons/icon-144x144.png') }}"/>
  
  <!-- PWA Manifest -->
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}"/>
  
  <!-- Apple Touch Icons -->
  <link rel="apple-touch-icon" sizes="152x152" href="{{ url_for('static', filename='icons/icon-152x152.png') }}"/>
  <link rel="apple-touch-icon" sizes="192x192" href="{{ url_for('static', filename='icons/icon-192x192.png') }}"/>
  
  <!-- SEO Meta Tags -->
  <meta name="description" content="Türkiye'nin en güvenilir online petshop'u. Kedi, köpek, kuş ve balık ürünlerinde uygun fiyat ve hızlı teslimat!"/>
  <meta name="keywords" content="petshop, kedi maması, köpek maması, pet ürünleri, online petshop, evcil hayvan"/>
  <meta name="author" content="Pethome"/>
  
  <!-- Open Graph Meta Tags -->
  <meta property="og:title" content="Pethome - Pet Ürünleri"/>
  <meta property="og:description" content="Türkiye'nin en güvenilir online petshop'u. Kedi, köpek, kuş ve balık ürünlerinde uygun fiyat ve hızlı teslimat!"/>
  <meta property="og:type" content="website"/>
  <meta property="og:url" content="https://pethome.com/"/>
  <meta property="og:image" content="{{ url_for('static', filename='icons/icon-512x512.png') }}"/>
  
  <!-- Twitter Card Meta Tags -->
  <meta name="twitter:card" content="summary_large_image"/>
  <meta name="twitter:title" content="Pethome - Pet Ürünleri"/>
  <meta name="twitter:description" content="Türkiye'nin en güvenilir online petshop'u"/>
  <meta name="twitter:image" content="{{ url_for('static', filename='icons/icon-512x512.png') }}"/>
  
  <!-- Structured Data for SEO -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "PetStore",
    "name": "Pethome",
    "description": "Türkiye'nin en güvenilir online petshop'u. Kedi, köpek, kuş ve balık ürünlerinde uygun fiyat ve hızlı teslimat!",
    "url": "https://pethome.com",
    "telephone": "+90-542-219-21-25",
    "address": {
      "@type": "PostalAddress",
      "addressCountry": "TR"
    },
    "sameAs": [
       "https://www.instagram.com/pethome",
       "https://www.facebook.com/pethome"
    ]
  }
  </script>
</head>
<body>
  <script>
    // Tema tercihini sayfa yüklenir yüklenmez uygula (FOUC azaltma)
    (function(){
      try {
        if (localStorage.getItem('theme') === 'dark') {
          document.body.classList.add('dark-mode');
        }
      } catch(e) {}
    })();
  </script>
  <div class="main-box position-relative">
    <!-- Header -->
    <div class="site-title d-flex justify-content-between align-items-center">
      <span>Pethome</span>
      <div class="nav-buttons d-flex align-items-center gap-2">
        <a href="/cart" class="nav-button cart-btn">
          <i class="fa fa-shopping-cart"></i>
          <span>Sepet{% if session.cart %} ({{ session.cart|length }}){% endif %}</span>
        </a>
        <a href="/contact" class="nav-button contact-btn">İletişim</a>
        <a href="/order-track" class="nav-button track-btn">
          <i class="fa fa-truck me-2"></i>Sipariş Takip
        </a>
        
        <!-- User Account Navigation -->
        {% if session.user_logged_in %}
        <div class="dropdown">
          <button class="nav-button user-btn dropdown-toggle" type="button" data-bs-toggle="dropdown">
            <i class="fa fa-user me-1"></i>{{ session.user_name }}
          </button>
          <ul class="dropdown-menu dropdown-menu-end">
            <li><a class="dropdown-item" href="/profile">
              <i class="fa fa-user-circle me-2"></i>Profilim
            </a></li>
            <li><a class="dropdown-item" href="/profile">
              <i class="fa fa-shopping-bag me-2"></i>Siparişlerim
            </a></li>
            <li><a class="dropdown-item" href="/wishlist">
              <i class="fa fa-heart me-2"></i>Favorilerim
            </a></li>
            <li><hr class="dropdown-divider"></li>
            <li><a class="dropdown-item" href="/logout">
              <i class="fa fa-sign-out-alt me-2"></i>Çıkış Yap
            </a></li>
          </ul>
        </div>
        {% else %}
        <a href="/login" class="nav-button login-btn">
          <i class="fa fa-sign-in-alt me-1"></i>Giriş
        </a>
        <a href="/register" class="nav-button register-btn">
          <i class="fa fa-user-plus me-1"></i>Üye Ol
        </a>
        {% endif %}
        
        <button id="themeToggle" class="nav-button theme-btn" title="Tema Değiştir">
          <i id="themeIcon" class="fa fa-moon"></i>
        </button>
      </div>
    </div>
    
    <!-- Site Description -->
    <div class="site-desc">
      Türkiye'nin en güvenilir online petshop'u. Kedi, köpek, kuş ve balık ürünlerinde uygun fiyat ve hızlı teslimat!<br>
       <span style="color:#053ff3;font-weight:600;">Pethome’a hoş geldiniz!</span>
    </div>

    <!-- Campaign Carousel -->
    {% if campaigns and campaigns|length > 0 %}
    <div class="campaign-carousel mb-4">
      <div id="campaignCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="3500" data-bs-wrap="true">
        <div class="carousel-inner">
          {% for c in campaigns %}
          <div class="carousel-item {% if loop.index0 == 0 %}active{% endif %}">
            <a href="{{ c.link }}" target="_blank">
              <img src="{{ c.image }}" class="d-block w-100" alt="Kampanya" loading="lazy">
              {% if c.title or c.description %}
              <div class="campaign-caption">
                {% if c.title %}<h5>{{ c.title }}</h5>{% endif %}
                {% if c.description %}<p>{{ c.description }}</p>{% endif %}
              </div>
              {% endif %}
            </a>
          </div>
          {% endfor %}
        </div>
        {% if campaigns|length > 1 %}
        <button class="carousel-control-prev" type="button" data-bs-target="#campaignCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Önceki</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#campaignCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Sonraki</span>
        </button>
        {% endif %}
      </div>
    </div>
    {% endif %}

    <!-- Category Alert -->
    {% if selected_category %}
    <div class="category-alert">
      <div><b>Kategori:</b> {{ selected_category }}</div>
      <a href="/change_category" class="category-change-btn">Kategoriyi Değiştir</a>
    </div>
    {% endif %}
    
    <!-- Cart Messages -->
    {% if session.cart_message %}
    <div class="alert alert-info alert-dismissible fade show" role="alert">
      {{ session.cart_message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% set _ = session.pop('cart_message', None) %}
    {% endif %}

    <!-- Mega Menu -->
    <div class="category-mega-menu mb-4">
      <div class="category-buttons d-flex flex-wrap gap-2" id="categoryButtons">
        <button class="category-btn" data-category="Mama">
          <span class="category-text">Mama</span>
        </button>
        <button class="category-btn" data-category="Ödül & Eğitim">
          <span class="category-text">Ödül & Eğitim</span>
        </button>
        <button class="category-btn" data-category="Bakım & Sağlık">
          <span class="category-text">Bakım & Sağlık</span>
        </button>
        <button class="category-btn" data-category="Aksesuar">
          <span class="category-text">Aksesuar</span>
        </button>
        <button class="category-btn" data-category="Marka">
          <span class="category-text">Marka</span>
        </button>
      </div>
      <div class="subcategory-dropdown"></div>
    </div>

    <!-- Search Bar -->
    <div class="search-container mb-4">
      <div class="input-group">
        <input type="search" class="form-control search-input" placeholder="Ürün ara..." aria-label="Ürün ara">
        <button class="btn search-btn" type="button" aria-label="Ara">
          <i class="fa fa-search"></i>
        </button>
      </div>
      <div class="search-suggestions" style="display: none;"></div>
    </div>

    <!-- Quick Filters -->
    <div class="quick-filters mb-4">
      <div class="d-flex flex-wrap gap-2 align-items-center mb-2">
        <span class="filter-label">Hızlı Filtreler:</span>
        <button class="btn btn-sm filter-btn" data-filter="price-low">En Ucuz</button>
        <button class="btn btn-sm filter-btn" data-filter="price-high">En Pahalı</button>
        <button class="btn btn-sm filter-btn" data-filter="newest">En Yeni</button>
        <button class="btn btn-sm filter-btn" data-filter="popular">Popüler</button>
      </div>
      
      <!-- Advanced Filters -->
      <div class="row g-3">
        <div class="col-md-3">
          <label class="form-label">Marka</label>
          <select class="form-select form-select-sm" id="brandFilter">
            <option value="">Tüm Markalar</option>
          </select>
        </div>
        <div class="col-md-3">
          <label class="form-label">Min Fiyat</label>
          <input type="number" class="form-control form-control-sm" id="minPriceFilter" placeholder="₺ Min">
        </div>
        <div class="col-md-3">
          <label class="form-label">Max Fiyat</label>
          <input type="number" class="form-control form-control-sm" id="maxPriceFilter" placeholder="₺ Max">
        </div>
        <div class="col-md-3">
          <button class="btn btn-primary btn-sm mt-4" id="applyFilters">
            <i class="fa fa-filter me-1"></i>Filtrele
          </button>
          <button class="btn btn-outline-secondary btn-sm mt-4 ms-1" id="clearFilters">
            <i class="fa fa-times me-1"></i>Temizle
          </button>
        </div>
      </div>
    </div>

    <!-- Breadcrumb Navigation -->
    <nav aria-label="breadcrumb" class="breadcrumb-nav mb-3">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">Ana Sayfa</a></li>
        {% if selected_category %}
        <li class="breadcrumb-item active" aria-current="page">{{ selected_category }}</li>
        {% endif %}
      </ol>
    </nav>

    <!-- Product Header -->
    <div class="product-header d-flex justify-content-between align-items-center mb-3">
      <div class="product-count">
        <span id="productCount">{{ products|length }} ürün listeleniyor</span>
      </div>
      <div class="sort-options">
        <select class="form-select form-select-sm" id="sortSelect" aria-label="Sıralama seçin">
          <option value="name">İsme göre</option>
          <option value="price-asc">Fiyat (Artan)</option>
          <option value="price-desc">Fiyat (Azalan)</option>
          <option value="newest">En Yeni</option>
        </select>
      </div>
    </div>

    <!-- Products Grid -->
    <div class="container-fluid product-list">
      <div class="row" id="productList">
        {% for product in products %}
        <div class="col-md-4 product-item">
          <div class="card product-card h-100">
            <a href="/product/{{ product.id }}" aria-label="{{ product.name }} detayları">
              <img src="{{ product.image }}" class="card-img-top" alt="{{ product.name }}" loading="lazy"/>
            </a>
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">
                {{ product.name }}
                {% if product.brand %}
                <span class="badge bg-secondary ms-2">{{ product.brand }}</span>
                {% endif %}
              </h5>
              <p class="text-muted">
                {{ product.category }} /
                {% if product.subcategory is string %}
                  {{ product.subcategory }}
                {% else %}
                  {{ product.subcategory|join(', ') }}
                {% endif %}
              </p>
              <h6 class="text-success mb-3">{{ product.price }} TL</h6>
              <a href="/add_to_cart/{{ product.id }}" class="btn add-to-cart-btn mt-auto" aria-label="{{ product.name }} sepete ekle">
                <i class="fa fa-shopping-cart me-2"></i>Sepete Ekle
              </a>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
      <div class="loading-content">
        <div class="loading-spinner"></div>
        <p>Yükleniyor...</p>
      </div>
    </div>

    <!-- Back to Top Button -->
    <button class="btn btn-primary back-to-top" id="backToTop" style="display: none; position: fixed; bottom: 20px; right: 20px; border-radius: 50%; width: 50px; height: 50px; z-index: 1000;" aria-label="Başa dön">
      <i class="fa fa-arrow-up"></i>
    </button>

  </div>
  
  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Set global variables for the app
    window.selectedCategory = "{{ selected_category|default('Köpek') }}";
  </script>
  <script src="{{ url_for('static', filename='app.js') }}?v=1.7.0"></script>
  <script src="{{ url_for('static', filename='theme.js') }}?v=1.7.0"></script>
  <script>
    // Sadece çalışan modülleri başlat - tema theme.js'de
    document.addEventListener('DOMContentLoaded', function() {
      console.log('🚀 Sayfa yüklendi, modüller başlatılıyor...');
      
      // Sadece var olan modülleri güvenli şekilde başlat
      try {
        if (window.PetShopApp) {
          if (PetShopApp.megaMenu && typeof PetShopApp.megaMenu.init === 'function') {
            PetShopApp.megaMenu.init();
          }
          
          if (PetShopApp.search && typeof PetShopApp.search.init === 'function') {
            PetShopApp.search.init();
          }
          
          if (PetShopApp.ux && typeof PetShopApp.ux.init === 'function') {
            PetShopApp.ux.init();
          }
          
          if (PetShopApp.wishlist && typeof PetShopApp.wishlist.init === 'function') {
            PetShopApp.wishlist.init();
          }
        }
        console.log('✅ Modüller başlatıldı!');
      } catch (error) {
        console.error('❌ Modül başlatma hatası:', error);
      }
    });
  </script>
  
  <!-- Structured Data for SEO -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Store",
    "name": "Pethome",
    "description": "Türkiye'nin en güvenilir online petshop'u",
    "url": "{{ request.url_root }}",
    "telephone": "+90-542-219-2125",
    "address": {
      "@type": "PostalAddress",
      "addressCountry": "TR"
    },
    "hasOfferCatalog": {
      "@type": "OfferCatalog",
      "name": "Pet Ürünleri",
      "itemListElement": [
        {% for product in products[:5] %}
        {
          "@type": "Offer",
          "itemOffered": {
            "@type": "Product",
            "name": "{{ product.name }}",
            "price": "{{ product.price }}",
            "priceCurrency": "TRY",
            "image": "{{ request.url_root }}{{ product.image[1:] if product.image.startswith('/') else product.image }}",
            "category": "{{ product.category }}"
          }
        }{% if not loop.last %},{% endif %}
        {% endfor %}
      ]
    }
  }
  </script>
</body>
</html>