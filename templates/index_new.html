<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="description" content="Türkiye'nin en güvenilir online petshop'u. Kedi, köpek, kuş ve balık ürünlerinde uygun fiyat ve hızlı teslimat!"/>
  <meta name="keywords" content="petshop, kedi maması, köpek maması, pet ürünleri, online petshop"/>
  <title>Pethome - Online Pet Ürünleri</title>
  
  <!-- Preload critical resources -->
  <link rel="preload" href="{{ url_for('static', filename='modern.css') }}" as="style">
  <link rel="preload" href="{{ url_for('static', filename='app.js') }}" as="script">
  
  <!-- Critical CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet"/>
  <link href="{{ url_for('static', filename='modern.css') }}" rel="stylesheet"/>
</head>
<body>
  <div class="main-box position-relative">
    <!-- Header -->
    <div class="site-title d-flex justify-content-between align-items-center">
      <span>Pethome</span>
      <div class="nav-buttons d-flex align-items-center gap-2">
        <a href="/cart" class="nav-button cart-btn">
          <i class="fa fa-shopping-cart"></i>
          <span>Sepet{% if session.cart %} ({{ session.cart|length }}){% endif %}</span>
        </a>
        <a href="/contact" class="nav-button contact-btn">İletişim</a>
        <a href="/order-track" class="nav-button track-btn">
          <i class="fa fa-truck me-2"></i>Sipariş Takip
        </a>
        <button id="themeToggle" class="nav-button theme-btn" title="Tema Değiştir">
          <i id="themeIcon" class="fa fa-moon"></i>
        </button>
      </div>
    </div>
    
    <!-- Site Description -->
    <div class="site-desc">
      Türkiye'nin en güvenilir online petshop'u. Kedi, köpek, kuş ve balık ürünlerinde uygun fiyat ve hızlı teslimat!<br>
      <span style="color:#053ff3;font-weight:600;">Hoş geldiniz!</span>
    </div>

    <!-- Campaign Carousel -->
    {% if campaigns and campaigns|length > 0 %}
    <div class="campaign-carousel mb-4">
      <div id="campaignCarousel" class="carousel slide" data-bs-ride="carousel" data-bs-interval="3500" data-bs-wrap="true">
        <div class="carousel-inner">
          {% for c in campaigns %}
          <div class="carousel-item {% if loop.index0 == 0 %}active{% endif %}">
            <a href="{{ c.link }}" target="_blank">
              <img src="{{ c.image }}" class="d-block w-100" alt="Kampanya" loading="lazy">
              {% if c.title %}
              <div class="campaign-caption">
                <h5>{{ c.title }}</h5>
              </div>
              {% endif %}
            </a>
          </div>
          {% endfor %}
        </div>
        {% if campaigns|length > 1 %}
        <button class="carousel-control-prev" type="button" data-bs-target="#campaignCarousel" data-bs-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Önceki</span>
        </button>
        <button class="carousel-control-next" type="button" data-bs-target="#campaignCarousel" data-bs-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="visually-hidden">Sonraki</span>
        </button>
        {% endif %}
      </div>
    </div>
    {% endif %}

    <!-- Category Alert -->
    {% if selected_category %}
    <div class="category-alert">
      <div><b>Kategori:</b> {{ selected_category }}</div>
      <a href="/change_category" class="category-change-btn">Kategoriyi Değiştir</a>
    </div>
    {% endif %}

    <!-- Mega Menu -->
    <div class="category-mega-menu mb-4">
      <div class="category-buttons d-flex flex-wrap gap-2" id="categoryButtons">
        <button class="category-btn" data-category="Mama">
          <span class="category-text">Mama</span>
        </button>
        <button class="category-btn" data-category="Ödül & Eğitim">
          <span class="category-text">Ödül & Eğitim</span>
        </button>
        <button class="category-btn" data-category="Bakım & Sağlık">
          <span class="category-text">Bakım & Sağlık</span>
        </button>
        <button class="category-btn" data-category="Aksesuar">
          <span class="category-text">Aksesuar</span>
        </button>
        <button class="category-btn" data-category="Marka">
          <span class="category-text">Marka</span>
        </button>
      </div>
      <div class="subcategory-dropdown"></div>
    </div>

    <!-- Search Bar -->
    <div class="search-container mb-4">
      <div class="input-group">
        <input type="search" class="form-control search-input" placeholder="Ürün ara..." aria-label="Ürün ara">
        <button class="btn search-btn" type="button" aria-label="Ara">
          <i class="fa fa-search"></i>
        </button>
      </div>
      <div class="search-suggestions" style="display: none;"></div>
    </div>

    <!-- Quick Filters -->
    <div class="quick-filters mb-4">
      <div class="d-flex flex-wrap gap-2 align-items-center">
        <span class="filter-label">Hızlı Filtreler:</span>
        <button class="btn btn-sm filter-btn" data-filter="price-low">En Ucuz</button>
        <button class="btn btn-sm filter-btn" data-filter="price-high">En Pahalı</button>
        <button class="btn btn-sm filter-btn" data-filter="newest">En Yeni</button>
        <button class="btn btn-sm filter-btn" data-filter="popular">Popüler</button>
      </div>
    </div>

    <!-- Breadcrumb Navigation -->
    <nav aria-label="breadcrumb" class="breadcrumb-nav mb-3">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">Ana Sayfa</a></li>
        {% if selected_category %}
        <li class="breadcrumb-item active" aria-current="page">{{ selected_category }}</li>
        {% endif %}
      </ol>
    </nav>

    <!-- Product Header -->
    <div class="product-header d-flex justify-content-between align-items-center mb-3">
      <div class="product-count">
        <span id="productCount">{{ products|length }} ürün listeleniyor</span>
      </div>
      <div class="sort-options">
        <select class="form-select form-select-sm" id="sortSelect" aria-label="Sıralama seçin">
          <option value="name">İsme göre</option>
          <option value="price-asc">Fiyat (Artan)</option>
          <option value="price-desc">Fiyat (Azalan)</option>
          <option value="newest">En Yeni</option>
        </select>
      </div>
    </div>

    <!-- Products Grid -->
    <div class="container-fluid product-list">
      <div class="row" id="productList">
        {% for product in products %}
        <div class="col-md-4 product-item">
          <div class="card product-card h-100">
            <a href="/product/{{ product.id }}" aria-label="{{ product.name }} detayları">
              <img src="{{ product.image }}" class="card-img-top" alt="{{ product.name }}" loading="lazy"/>
            </a>
            <div class="card-body d-flex flex-column">
              <h5 class="card-title">
                {{ product.name }}
                {% if product.brand %}
                <span class="badge bg-secondary ms-2">{{ product.brand }}</span>
                {% endif %}
              </h5>
              <p class="text-muted">
                {{ product.category }} /
                {% if product.subcategory is string %}
                  {{ product.subcategory }}
                {% else %}
                  {{ product.subcategory|join(', ') }}
                {% endif %}
              </p>
              <h6 class="text-success mb-3">{{ product.price }} TL</h6>
              <a href="/add_to_cart/{{ product.id }}" class="btn add-to-cart-btn mt-auto" aria-label="{{ product.name }} sepete ekle">
                <i class="fa fa-shopping-cart me-2"></i>Sepete Ekle
              </a>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
      <div class="loading-content">
        <div class="loading-spinner"></div>
        <p>Yükleniyor...</p>
      </div>
    </div>

    <!-- Back to Top Button -->
    <button class="btn btn-primary back-to-top" id="backToTop" style="display: none; position: fixed; bottom: 20px; right: 20px; border-radius: 50%; width: 50px; height: 50px; z-index: 1000;" aria-label="Başa dön">
      <i class="fa fa-arrow-up"></i>
    </button>

  </div>
  
  <!-- Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Set global variables for the app
    window.selectedCategory = "{{ selected_category|default('Köpek') }}";
  </script>
  <!-- APP.JS KALDIRILDI - TEMA ÇAKIŞMASI ÖNLENDİ -->
  
  <!-- Structured Data for SEO -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Store",
    "name": "Pethome",
    "description": "Türkiye'nin en güvenilir online petshop'u",
    "url": "{{ request.url_root }}",
    "telephone": "+90-542-219-2125",
    "address": {
      "@type": "PostalAddress",
      "addressCountry": "TR"
    },
    "hasOfferCatalog": {
      "@type": "OfferCatalog",
      "name": "Pet Ürünleri",
      "itemListElement": [
        {% for product in products[:5] %}
        {
          "@type": "Offer",
          "itemOffered": {
            "@type": "Product",
            "name": "{{ product.name }}",
            "price": "{{ product.price }}",
            "priceCurrency": "TRY",
            "image": "{{ request.url_root }}{{ product.image[1:] if product.image.startswith('/') else product.image }}",
            "category": "{{ product.category }}"
          }
        }{% if not loop.last %},{% endif %}
        {% endfor %}
      ]
    }
  }

  // Tema sistemi için fallback ve kalıcılık
  (function(){
    // Sayfa yüklenir yüklenmez temayı uygula
    const isDark = localStorage.getItem('theme') === 'dark';
    if (isDark) {
      document.body.classList.add('dark-mode');
    }

    // DOM yüklendikten sonra buton işlevselliği
    document.addEventListener('DOMContentLoaded', function(){
      const btn = document.getElementById('themeToggle');
      if (btn) {
        const icon = document.getElementById('themeIcon');
        if (icon) icon.className = isDark ? 'fa fa-sun' : 'fa fa-moon';
        
        btn.addEventListener('click', function(e) {
          e.preventDefault();
          const currentDark = document.body.classList.contains('dark-mode');
          const newDark = !currentDark;
          
          document.body.classList.toggle('dark-mode', newDark);
          if (icon) icon.className = newDark ? 'fa fa-sun' : 'fa fa-moon';
          localStorage.setItem('theme', newDark ? 'dark' : 'light');
        });
      }
    });
  })();
  </script>
  <!-- THEME.JS KALDIRILDI - KENDİ TEMA SİSTEMİ EKLENDİ -->
</body>
</html>